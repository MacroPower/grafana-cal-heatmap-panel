{"version":3,"sources":["../src/cal_heatmap_ctrl.js"],"names":["TimeSeries","MetricsPanelCtrl","moment","CalHeatMapCtrl","$scope","$element","$injector","panelDefaults","datasource","config","animationDuration","domain","subDomain","verticalOrientation","colLimit","rowLimit","cellSize","cellPadding","cellRadius","domainGutter","label","position","rotate","width","legendStr","legendColors","min","max","empty","base","displayLegend","_","defaults","panel","angular","copy","seriesList","element","events","on","onRender","bind","onDataReceived","onDataError","onDataSnapshotLoad","onInitEditMode","seriesData","index","datapoints","alias","target","series","color","unit","length","last","utc","datapointsCount","data","cells","unitLen","tzOffset","Date","getTimezoneOffset","to_i","t","getDay","x","y","parseFloat","isNaN","i","parseInt","count","sum","sumsq","Infinity","Math","avg","sd","sqrt","thresh","addEditorTab","snapshotData","err","render","dataList","map","seriesHandler","subDomains","cand","indexOf","elem","find","update","range","points","from","to","days","diff","cal","CalHeatMap","itemSelector","start","toDate","format","domainLabelFormat","replace","legend","calcThresholds","split","init","destroy","e","console","log","innerHTML","templateUrl"],"mappings":"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","file":"cal_heatmap_ctrl.js","sourcesContent":["import TimeSeries from 'app/core/time_series2';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport './bower_components/d3/d3.js';\nimport './bower_components/cal-heatmap/cal-heatmap.js';\n\nexport class CalHeatMapCtrl extends MetricsPanelCtrl {\n  constructor($scope, $element, $injector) {\n    super($scope, $injector);\n\n    var panelDefaults = {\n      datasource: null,\n      config: {\n\tanimationDuration: 0,\n        domain: 'auto',\n        subDomain: 'auto',\n        verticalOrientation: false,\n        colLimit: null,\n        rowLimit: null,\n        cellSize: 10,\n        cellPadding: 2,\n        cellRadius: 0,\n        domainGutter: 2,\n        label: {\n          position: 'bottom',\n          rotate: 'null',\n          width: 60,\n        },\n        legendStr: '',\n        legendColors: {\n          min: \"#666\",\n          max: \"steelblue\",\n          empty: \"#222\",\n          base: \"transparent\",\n        },\n        displayLegend: true,\n      },\n    };\n\n    _.defaults(this.panel, angular.copy(panelDefaults));\n    this.seriesList = [];\n\n    this.element = $element;\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  seriesHandler(seriesData, index) {\n    var datapoints = seriesData.datapoints;\n    var alias = seriesData.target;\n\n    var series = new TimeSeries({\n      datapoints: datapoints,\n      alias: alias,\n      color: index,\n      unit: false,\n    });\n\n    if (datapoints && datapoints.length > 0) {\n      var last = moment.utc(datapoints[datapoints.length - 1][1]);\n\n      this.datapointsCount += datapoints.length;\n    }\n\n    return series;\n  }\n\n  calcThresholds(data, subDomain) {\n    var cells = {}; // emulate Cal-HeatMap's cell splitter\n    var unitLen = {};\n    var tzOffset = (new Date()).getTimezoneOffset() * 60;\n\n    var to_i;\n    if (subDomain == 'week')\n      to_i = t => t - t % (24*60*60) - (new Date(t * 1000)).getDay() * (24*60*60);\n    else if (subDomain == 'day')\n      to_i = t => t - t % (24*60*60);\n    else if (subDomain == 'hour')\n      to_i = t => t - t % (60*60);\n    else if (subDomain == 'min')\n      to_i = t => t - t % 60;\n    else\n      throw \"Invalid subDomain in calcThresholds()\";\n\n    for (var x in data) {\n      var y = parseFloat(data[x]);\n      if (isNaN(y))\n\tcontinue;\n      var i = to_i(parseInt(x) + tzOffset);\n      if (cells[i])\n\tcells[i] += y;\n      else\n\tcells[i] = y;\n    }\n\n    var [count, sum, sumsq, min, max] = [0, 0, 0, Infinity, -Infinity];\n    for (var x in cells) {\n      var y = parseFloat(cells[x]);\n      if (isNaN(y))\n\tcontinue;\n      count++;\n      sum += y;\n      sumsq += y * y;\n      min = Math.min(min, y);\n      max = Math.max(max, y);\n    }\n    var avg = sum / count;\n    var sd = Math.sqrt((sumsq - avg*avg) / count);\n    var thresh = [];\n    min = Math.max(min, avg - sd*1.5);\n    max = Math.min(max, avg + sd*1.5);\n    for (var i = 0; i < 9; i++)\n      thresh[i] = min + (max - min) / 8 * i;\n    return thresh;\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options',\n                      'public/plugins/neocat-cal-heatmap-panel/editor.html',\n                      2);\n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData.data);\n  }\n\n  onDataError(err) {\n    this.seriesList = [];\n    this.render([]);\n  }\n\n  onDataReceived(dataList) {\n    this.seriesList = dataList.map(this.seriesHandler.bind(this));\n    this.render(this.seriesList);\n  }\n\n  onRender() {\n    if (!this.seriesList || !this.seriesList[0])\n      this.seriesList = [{\"datapoints\":[]}];\n\n    var subDomains = {\n      'auto':  ['auto'],\n      'month': ['auto', 'day', 'x_day', 'week', 'x_week'],\n      'day':   ['auto', 'hour', 'x_hour'],\n      'hour':  ['auto', 'min', 'x_min']\n    };\n    var cand = subDomains[this.panel.config.domain];\n    if (!cand || cand.indexOf(this.panel.config.subDomain) < 0)\n      this.panel.config.subDomain = 'auto';\n\n    var elem = this.element.find(\".cal-heatmap-panel\")[0];\n    var update = function() {\n      if (!this.range) return;\n\n      var data = {};\n      var points = this.seriesList[0].datapoints;\n      for (var i = 0; i < points.length; i++) {\n        data[points[i][1] / 1000] = points[i][0];\n      }\n\n      var from = moment.utc(this.range.from);\n      var to = moment.utc(this.range.to);\n      var days = to.diff(from, \"days\") + 1;\n      var cal = this.cal = new CalHeatMap();\n\n      var config = angular.copy(this.panel.config)\n      config.itemSelector = elem;\n      config.data = data;\n      config.label.position = config.verticalOrientation ? 'left' : 'bottom';\n\n      if (config.domain == 'auto') {\n        config.domain = days > 31 ? \"month\" : days > 3 ? \"day\" : \"hour\";\n      }\n      if (config.subDomain == 'auto') {\n        delete config.subDomain;\n      }\n      config.start = moment.utc(this.range.from).toDate();\n      if (config.domain == 'month') {\n        config.range = moment.utc(to.format('YYYY-MM')).diff(\n\t  moment.utc(from.format('YYYY-MM')), \"months\") + 1;\n        config.domainLabelFormat = '%y/%m';\n      }\n      else if (config.domain == 'day') {\n        config.range = moment.utc(to.format('YYYY-MM-DD')).diff(\n\t  moment.utc(from.format('YYYY-MM-DD')), \"days\") + 1;\n        config.domainLabelFormat = '%m/%d';\n      }\n      else if (config.domain == 'hour') {\n        config.range = moment.utc(to.format('YYYY-MM-DD HH:00')).diff(\n\t  moment.utc(from.format('YYYY-MM-DD HH:00')), \"hours\") + 1;\n        config.domainLabelFormat = '%d %H:%M';\n      }\n      config.range = Math.min(config.range, 100); // avoid browser hang\n\n      if (!config.legendStr || config.legendStr == 'auto') {\n\tvar subDomain = config.subDomain ?\n\t    config.subDomain.replace('x_', '') : subDomains[config.domain][1];\n\tconfig.legend = this.calcThresholds(data, subDomain);\n      } else {\n        config.legend = config.legendStr ?\n          config.legendStr.split(/\\s*,\\s*/).map(x => parseFloat(x)) : null;\n      }\n\n      this.cal.init(config);\n    }.bind(this);\n\n    if (this.cal) {\n      try {\n        this.cal.destroy(update);\n      } catch (e) {\n        console.log(\"Destroy failed: \" + e);\n        elem.innerHTML = '';\n        update();\n      }\n    } else {\n      update();\n    }\n  }\n\n}\n\nCalHeatMapCtrl.templateUrl = 'module.html';\n"]}